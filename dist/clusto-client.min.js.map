{"version":3,"file":"clusto-client.min.js","sources":["_build/es6/clusto-client.js"],"names":["hyperquest","require","URI","Promise","Applications","ATTRIBUTE","ENTITY","RESOURCE_MANAGER","Mode","COMPACT","EXPANDED","Headers","MODE","PER_PAGE","PAGE","PAGES","MINIFY","AttributeType","INTEGER","STRING","DATETIME","RELATION","JSON","Client","data","this","mount_points","Map","_base_url","attribute","__proto__","app","get","opts","path","segment","name","key","subkey","number","_get","toString","delete","_delete","entity","options","driver","mode","resource","manager","base_url","clone","get_meta","then","_this","clear","_step","_iterator","Object","keys","Symbol","iterator","_iteratorNormalCompletion","next","done","mount","value","set","params","pool","children","Array","bno","names","_request","method","url","normalizePath","headers","Clusto-Minify","Accept","setSearch","req","uri","resolve","reject","body","on","buffer","parse","e"],"mappings":"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","sourcesContent":["const hyperquest = require('hyperquest');\nconst URI = require('URIjs');\nconst Promise = require('bluebird');\n/* -----------------------------------------------------------------------------\n   API Constants\n   ----------------------------------------------------------------------------- */\nexport const Applications = {\n    ATTRIBUTE: 'clustoapi.apps.attribute',\n    ENTITY: 'clustoapi.apps.entity',\n    RESOURCE_MANAGER: 'clustoapi.apps.resourcemanager'\n};\nexport const Mode = {\n    COMPACT: 'compact',\n    EXPANDED: 'expanded'\n};\nexport const Headers = {\n    MODE: 'Clusto-Mode',\n    PER_PAGE: 'Clusto-Per-Page',\n    PAGE: 'Clusto-Page',\n    PAGES: 'Clusto-Pages',\n    MINIFY: 'Clusto-Minify'\n};\nexport const AttributeType = {\n    INTEGER: 'int',\n    STRING: 'string',\n    DATETIME: 'datetime',\n    RELATION: 'relation',\n    JSON: 'json'\n};\n/* -----------------------------------------------------------------------------\n   Client\n   ----------------------------------------------------------------------------- */\nexport class Client {\n    constructor(data) {\n        this.mount_points = new Map();\n        this._base_url = new URI('http://localhost:9664');\n        /* --------------------------------------------------\n           Attribute module\n           -------------------------------------------------- */\n        this.attribute = {\n            __proto__: this,\n            app: Applications.ATTRIBUTE,\n            /**\n             * @see http://clusto-apiserver.readthedocs.org/clustoapi/apps/all.html#clustoapi.apps.attribute.attrs\n             */\n            get(opts) {\n                let path = new URI();\n                if (typeof opts === 'string') {\n                    path.segment(opts); /* name */\n                }\n                else {\n                    path.segment(opts.name);\n                    if (opts.key) {\n                        path.segment(opts.key);\n                    }\n                    if (opts.subkey) {\n                        path.segment(opts.subkey);\n                    }\n                    if (opts.number) {\n                        path.segment(opts.number);\n                    }\n                }\n                return this._get(path.toString(), {\n                    app: this.app\n                });\n            },\n            /**\n             * @see http://clusto-apiserver.readthedocs.org/clustoapi/apps/all.html#clustoapi.apps.attribute.del_attrs\n             */\n            delete(opts) {\n                let path = new URI()\n                    .segment(opts.name)\n                    .segment(opts.key);\n                if (opts.subkey) {\n                    path.segment(opts.subkey);\n                }\n                if (opts.number) {\n                    path.segment(opts.number);\n                }\n                return this._delete(path.toString(), {\n                    app: this.app\n                });\n            }\n        };\n        /* --------------------------------------------------\n           Entity module\n           -------------------------------------------------- */\n        this.entity = {\n            __proto__: this,\n            app: Applications.ENTITY,\n            /**\n             * @see http://clusto-apiserver.readthedocs.org/clustoapi/apps/all.html#clustoapi.apps.entity.list\n             * @see http://clusto-apiserver.readthedocs.org/clustoapi/apps/all.html#clustoapi.apps.entity.show\n             */\n            get(opts) {\n                let path = new URI();\n                let options = (typeof opts === 'string') ? { driver: opts } : opts || {};\n                if (options.driver) {\n                    path.segment(options.driver);\n                }\n                if (options.name) {\n                    path.segment(options.name);\n                }\n                return this._get(path.toString(), {\n                    app: this.app,\n                    mode: options.mode\n                });\n            },\n            /**\n             * @see http://clusto-apiserver.readthedocs.org/clustoapi/apps/all.html#clustoapi.apps.entity.delete\n             */\n            delete(opts) {\n                let path = new URI()\n                    .segment(opts.driver)\n                    .segment(opts.name);\n                return this._delete(path.toString(), {\n                    app: this.app\n                });\n            }\n        };\n        /* --------------------------------------------------\n           Resource manager module\n           -------------------------------------------------- */\n        this.resource = {\n            __proto__: this,\n            app: Applications.RESOURCE_MANAGER,\n            /**\n             * @see http://clusto-apiserver.readthedocs.org/clustoapi/apps/all.html#clustoapi.apps.resourcemanager.list\n             * @see http://clusto-apiserver.readthedocs.org/clustoapi/apps/all.html#clustoapi.apps.resourcemanager.show\n             */\n            get(opts) {\n                let path = new URI();\n                let options = (typeof opts === 'string') ? { driver: opts } : opts || {};\n                if (options.driver) {\n                    path.segment(options.driver);\n                }\n                if (options.manager) {\n                    path.segment(options.manager);\n                }\n                return this._get(path.toString(), {\n                    app: this.app,\n                    mode: options.mode\n                });\n            },\n            /**\n             * @see http://clusto-apiserver.readthedocs.org/clustoapi/apps/all.html#clustoapi.apps.resourcemanager.deallocate\n             */\n            delete(opts) {\n                let path = new URI()\n                    .segment(opts.driver)\n                    .segment(opts.manager);\n                return this._delete(path.toString(), {\n                    app: this.app\n                });\n            }\n        };\n        if (data) {\n            if (typeof data === 'string') {\n                this._base_url = new URI(data);\n            }\n            else {\n                if (data.base_url) {\n                    this._base_url = new URI(data.base_url);\n                }\n            }\n        }\n    }\n    get base_url() {\n        return this._base_url.clone();\n    }\n    /**\n     * Initialize the client, setting up the map of clusto application\n     * mount points (base URL paths).\n     *\n     * @returns Promise\n     */\n    init() {\n        return this.get_meta()\n            .then(data => {\n            this.mount_points.clear();\n            for (let mount of Object.keys(data)) {\n                let app = data[mount];\n                this.mount_points.set(app, mount);\n            }\n        });\n    }\n    /* --------------------------------------------------\n       Main module\n       -------------------------------------------------- */\n    /**\n     * @see http://clusto-apiserver.readthedocs.org/clustoapi/all.html#clustoapi.server.version\n     */\n    get_version() {\n        return this._get('/__version__');\n    }\n    /**\n     * @see http://clusto-apiserver.readthedocs.org/clustoapi/all.html#clustoapi.server.meta\n     */\n    get_meta() {\n        return this._get('/__meta__');\n    }\n    /**\n     * @see http://clusto-apiserver.readthedocs.org/clustoapi/all.html#clustoapi.server.build_docs\n     */\n    get_doc() {\n        return this._get('/__doc__');\n    }\n    /**\n     * @see\n     */\n    get_driverlist() {\n        return this._get('/driverlist');\n    }\n    /**\n     * @see http://clusto-apiserver.readthedocs.org/clustoapi/all.html#clustoapi.server.get_from_pools\n     */\n    get_from_pools(opts) {\n        let options = { params: {} };\n        if (typeof opts === 'string') {\n            options.params.pool = opts;\n        }\n        else {\n            options.params.pool = opts.pool;\n            options.params.driver = opts.driver;\n            options.params.children = opts.children;\n            options.mode = opts.mode;\n        }\n        return this._get('/from-pools', options);\n    }\n    /**\n     * @see http://clusto-apiserver.readthedocs.org/clustoapi/all.html#clustoapi.server.get_by_name\n     */\n    get_by_name(opts) {\n        let options = { params: {} };\n        let name = null;\n        if (typeof opts === 'string') {\n            name = opts;\n        }\n        else {\n            name = opts.name;\n            if (opts.mode) {\n                options.mode = opts.mode;\n            }\n            if (opts.driver) {\n                options.params.driver = opts.driver;\n            }\n        }\n        return this._get(`/by-name/${name}`, options);\n    }\n    /**\n     * @see http://clusto-apiserver.readthedocs.org/clustoapi/all.html#clustoapi.server.get_by_names\n     */\n    get_by_names(opts) {\n        let options = { params: {} };\n        if (opts instanceof Array) {\n            options.params.name = opts;\n        }\n        else {\n            let bno = opts;\n            options.params.name = bno.names;\n            if (bno.mode) {\n                options.mode = bno.mode;\n            }\n        }\n        return this._get('/by-names', options);\n    }\n    /**\n     * @see http://clusto-apiserver.readthedocs.org/clustoapi/all.html#clustoapi.server.get_by_attr\n     */\n    get_by_attr(opts) {\n        let options = { params: {} };\n        if (typeof opts === 'string') {\n            options.params.key = opts;\n        }\n        else {\n            options.params.key = opts.key;\n            if (opts.subkey) {\n                options.params.subkey = opts.subkey;\n            }\n            if (opts.value) {\n                options.params.value = opts.value;\n            }\n        }\n        return this._get('/by-attr', options);\n    }\n    /* ----------------------------------------\n       Internal helpers\n       ---------------------------------------- */\n    _get(path, options) {\n        return this._request('GET', path, options);\n    }\n    _delete(path, options) {\n        return this._request('DELETE', path, options);\n    }\n    _request(method, path, options) {\n        // Build request URL\n        let url = this.base_url;\n        if (options && options.app) {\n            url.segment(this.mount_points.get(options.app));\n        }\n        url.segment(path)\n            .normalizePath();\n        // Set up headers\n        let headers = {\n            'Clusto-Minify': true,\n            'Accept': 'application/json'\n        };\n        if (options && options.mode) {\n            headers[Headers.MODE] = options.mode;\n        }\n        // Query string\n        if (options && options.params) {\n            url.setSearch(options.params);\n        }\n        let req = hyperquest({\n            method: method,\n            uri: url.toString(),\n            headers: headers\n        });\n        return new Promise((resolve, reject) => {\n            let body = '';\n            req\n                .on('data', (buffer) => {\n                body += buffer.toString();\n            })\n                .on('end', () => {\n                let data = JSON.parse(body);\n                resolve(data);\n            })\n                .on('error', (e) => {\n                reject(e);\n            });\n        });\n    }\n}\n//# sourceMappingURL=clusto-client.js.map"]}